<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Event Admin DJ Swordz</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; padding: 2rem; }
    input, button { margin: 0.2rem; }
    .event-list { margin-top: 2rem; }
    .event-item { margin-bottom: 0.5rem; }
    .delete-btn { margin-left: 1rem; color: #fff; background: #800020; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Event Admin DJ Swordz</h2>
  <form id="addEventForm">
    <input type="date" id="eventDate" placeholder="date" required>
    <input type="text" id="eventDay" placeholder="day" required>
    <input type="text" id="eventTitle" placeholder="title" required>
    <input type="text" id="eventPlace" placeholder="place" required>
    <input type="url" id="facebook-input" name="facebook" placeholder="https://facebook.com/events/...">
    <button type="submit">Add Event</button>
  </form>
  <div class="event-list" id="eventList"></div>
  <script>
    // Simpele wachtwoordbeveiliging
    if (prompt("Admin password:") !== "DJSWORDZ") location.href = "/";

    // Feedback element
    const feedback = document.createElement('div');
    feedback.style.color = '#ff5050';
    feedback.style.marginTop = '1rem';
    document.body.appendChild(feedback);

    // Events ophalen en tonen
    async function loadEvents() {
      feedback.textContent = '';
      try {
        const res = await fetch('events.json?' + Date.now());
        if (!res.ok) throw new Error('events.json niet gevonden');
        const events = await res.json();
        const list = document.getElementById('eventList');
        list.innerHTML = '';
        events.forEach((ev, i) => {
          const div = document.createElement('div');
          div.className = 'event-item';
          let fbHtml = '';
          if (ev.facebook) {
            fbHtml = ` <a href='${ev.facebook}' target='_blank' title='Facebook Event'><img src='assets/facebook.png' alt='Facebook Event' style='width:22px;height:22px;vertical-align:middle;margin-left:6px;'/></a>`;
          }
          div.innerHTML = `${ev.date} (${ev.day}) - <b>${ev.title}</b> @ ${ev.place}${fbHtml} <button class="delete-btn" onclick="deleteEvent(${i})">Delete</button>`;
          list.appendChild(div);
        });
      } catch (err) {
        feedback.textContent = 'Fout bij laden events: ' + err.message;
      }
    }
    loadEvents();

    // Event toevoegen
    document.getElementById('addEventForm').onsubmit = async function(e) {
      e.preventDefault();
      feedback.textContent = '';
      try {
        const date = eventDate.value;
        const day = eventDay.value;
        const title = eventTitle.value;
        const place = eventPlace.value;
        const facebook = document.getElementById('facebook-input').value.trim();
        const res = await fetch('events.json?' + Date.now());
        if (!res.ok) throw new Error('events.json niet gevonden');
        const events = await res.json();
        events.push({ date, day, title, place, facebook });
        await saveEvents(events);
        loadEvents();
        this.reset();
      } catch (err) {
        feedback.textContent = 'Fout bij toevoegen: ' + err.message;
      }
    };

    // Event verwijderen
    window.deleteEvent = async function(idx) {
      feedback.textContent = '';
      try {
        const res = await fetch('events.json?' + Date.now());
        if (!res.ok) throw new Error('events.json niet gevonden');
        const events = await res.json();
        events.splice(idx, 1);
        await saveEvents(events);
        loadEvents();
      } catch (err) {
        feedback.textContent = 'Fout bij verwijderen: ' + err.message;
      }
    };

    // Opslaan (werkt alleen met backend, niet direct op file)
    async function saveEvents(events) {
      const res = await fetch('save-events.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(events)
      });
      if (!res.ok) throw new Error('Kan events niet opslaan');
    }
  </script>
</body>
</html>
